<!--pages/product/detail.wxml-->
<!-- 产品相册 -->
<swiper indicator-dots="{{gallery.displayDots}}"
  indicator-color="{{gallery.indicatorColor}}"
  indicator-active-color="{{gallery.indicatorActiveColor}}"
  autoplay="{{gallery.autoplay}}" duration="{{gallery.duration}}"
  interval="{{gallery.interval}}"
  style="height:{{gallery.heights[gallery.index]}}px"
  bindchange="galleryChange"
  >
  <block wx:for="{{product.gallery}}" wx:key="index">
    <swiper-item>
      <image src="{{item}}" class="slide-image" style="height:{{gallery.heights[gallery.index]}}px;width:{{gallery.width}}px;" bindload="galleryLoad" bindtap="galleryTap" data-id="{{index}}"/>
    </swiper-item>
  </block>
</swiper>

<!-- 产品名称 价格 -->
<wxs module="filters" src="../../assets/utils.wxs"></wxs>
<view class="product-meta">
  <!-- 限时促销 -->
  <view class="product-promotion" wx:if="{{product.is_promote}}">
      <strong class="product-price">￥<text>{{filters.toFix(product.price, 2)}}</text></strong>
      <view class="product-promotion-tags">
          <view class="product-market-price">￥{{filters.toFix(product.market_price, 2)}}</view>
          <view class="product-promotion-tag">
              <i class="iconfont icon-clock"></i>
              <text>限时秒杀</text>
          </view>
      </view>
      <view class="product-promotion-timer">
          <view>距结束还剩</view>
          <view class="product-promotion-left">
              <text>{{product.hour}}</text>:<text>{{product.min}}</text>:<text>{{product.second}}</text>
          </view>
      </view>
  </view>

  <!-- 产品名称 -->
  <view class="product-info">
    <view class="product-name">{{product.name}}</view>
    <button open-type="share" class="product-share">
      <i class="iconfont icon-share"></i>
      <view>分享</view>
    </button>
  </view>
  
  <!-- 产品价格 -->
  <view class="product-price-info" wx:if="{{!product.is_promote}}">
    <strong>￥<text>{{filters.toFix(product.price, 2)}}</text></strong>

    <view class="product-discount">
      <text class="product-market-price">￥{{filters.toFix(product.market_price, 2)}}</text>
      <text class="product-discount-tag">{{filters.toFix(product.discount, 1)}}折</text>
    </view>
  </view>

    
  <!-- 物流信息 -->
  <view class="product-express-info">
    <block wx:if="{{product.shipping_free}}">
    包邮
    </block>
    <block wx:else>
    重量: {{product.weight}}g
    </block>

    <block wx:if="{{product.spec != ''}}">
    规格: {{product.spec}}
    </block>
  </view>

  <!-- 优惠信息 -->
  <view class="product-discount-info" wx:if="{{product.given_integral > 0}}">
    <view>
      <label class="product-discount-label">优惠</label>
      <text class="product-discount-content">赠送{{filters.toFix(product.given_integral, 2)}}积分</text>
    </view>
  </view>
</view>

<view class="product-meta quantity">
  <label for="buy_num">数量</label>
  <view class="quantity-number">
      <text class="minus iconfont icon-minus {{ count > 1 ? 'on': ''}}" catchtap="countMinus"></text>
      <input class="quantity-input" name="buy_num" type="number" value="{{count}}" bindblur="countInput"/>
      <text class="plus on iconfont icon-plus {{ count < product.inventory ? 'on': ''}}" catchtap="countPlus"></text>
  </view>
  <text id="inventory_count" class="inventory-count">库存: {{product.inventory}}</text>
</view>

<navigator url="/pages/product/comment?id={{product.id}}" class="meta-with-arrow product-comment">
    宝贝评价({{product.comments.count}})
</navigator>

<!-- 猜你喜欢 -->
<view class="hdj-favorite-block hdj-block">
    <h3>
        猜你喜欢
    </h3>
    <view class="hdj-block-product-list">
      <block wx:for="{{favorite_products}}" wx:for-item="product" wx:key="index">
          <template is="productItem" data="{{...product}}"/>
      </block>
    </view>
</view>

<!-- 产品专区产品模板 -->
<template name="productItem">
  <navigator class="hdj-block-product-item"  url="/pages/product/detail?id={{id}}">
        <image src="{{img}}" class="hdj-block-product-img" mode="widthFix"/>
        <view class="hdj-block-product-name">{{name}}</view>
        <view class="hdj-block-product-desc">{{desc}}</view>
        <view class="hdj-block-product-price">
          <text class="product-price-mark">￥</text>
          <text class="product-price">{{filters.toFix(price, 0)}}</text>
          <text class="product-market-price">￥{{filters.toFix(shop_price, 0)}}</text>
        </view>
  </navigator>
</template>

<!-- 产品详情 -->
<import src="../../assets/wxParse/wxParse.wxml"/>
<view class="product-content">
  <template is="wxParse" data="{{wxParseData:product_detail.nodes}}"/>
</view>

<view class="footer-block"></view>

<!-- 购买层 -->
<view class="mask {{displayPanel ? 'mask-show': ''}}" catchtap="hideBuyPanel"></view>
<view class="panel {{displayPanel ? 'panel-show': ''}}">
  <view class="panel-header">
    <image class="panel-image" src="{{product.img}}" mode="widthFix"/>
    <view class="panel-info">
      <view class="panel-price font-red font-m">
        <text>￥</text>
        <block wx:if="{{!member}}">
        <text class="font-l">{{filters.getInt(product.price)}}</text>
        <text>.{{filters.getDigital(product.price, 2)}}</text>
        </block>

        <block wx:else>
        <text class="font-l">{{filters.getInt(member.level_price)}}</text>
        <text>.{{filters.getDigital(member.level_price, 2)}}</text>
        </block>

        <text class="font-gray market-price">￥{{filters.toFix(product.market_price, 2)}}</text>
      </view>

      <view class="panel-inventory font-m">
        库存{{product.inventory}}件
      </view>
    </view>

    <view class="panel-close iconfont icon-times font-gray" catchtap="hideBuyPanel"></view>
  </view>

  <view class="panel-count-picker">
    <text class="font-gray">数量</text>

    <view class="panel-count-group">
      <button class="panel-count-minus iconfont icon-minus" disabled="{{count <= 1}}" catchtap="countMinus"></button>
      <input type="number" class="panel-count-input" value="{{count}}" bindblur="countInput"/>
      <button class="panel-count-plus iconfont icon-plus" disabled="{{count >= product.inventory}}" catchtap="countPlus"></button>
    </view>
  </view>

  <view class="panel-toolbar">
    <button class="confirm-btn" catchtap="buy" disabled="{{product.inventory < count || count <= 0}}">确定</button>
  </view>
</view>

<!-- 底部操作菜单 -->
<block wx:if="{{product.is_grant == 0}}">
<view class="product-footer">
  <navigator url="/pages/cart/index" open-type="switchTab" class="menu-cart">
    <icon class="iconfont icon-cart"></icon>
    <text>购物车</text>
  </navigator>

  <button class="menu-add-to-cart-btn" catchtap="addToCart" disabled="{{!can_checkout}}">加入购物车</button>
  <button class="menu-buy-now-btn" catchtap="buyNow" disabled="{{!can_checkout}}">立即购买</button>
</view>
</block>

<block wx:else>
<view class="product-footer">
  <block wx:if="{{member.level_id == 1}}">
  <button class="menu-direct-buy-btn iconfont icon-vip" catchtap="directBuy" disabled="{{!can_checkout}}"> 成为会员</button>
  </block>

  <block wx:else>
  <button class="menu-direct-buy-btn iconfont icon-vip" catchtap="directBuy" disabled="{{!can_checkout}}"> 立即续费</button>
  </block>
</view>
</block>